# FdAvg : This `README.md` is intended for personal use

# Usage

## Combination Script

### Example
Go to project directory `/FedL-Sync-FDA` and create the combinations file:
```bash
python -m FdAvg.utils.create_combinations --comb_file_id 0 --fda naive sketch --nn LeNet-5 --b 32 64 128 --e 50 --th 0.5 1.0
```

# Local simulation

## Example
Go to project directory `/FedL-Sync-FDA` and run the following command:
```bash
python -m local_simulator --n_gpus 2 --n_sims 12 --comb_file_id 0 --gpu_mem 5248
```

## Typical Workflow for LeNet-5

Go to project directory `/FedL-Sync-FDA` and create the combinations file:

```shell
python -m FdAvg.utils.create_combinations --comb_file_id 0 --fda naive linear sketch --nn LeNet-5 --b 32 64 128 256 --e 200 --th 0.5
```
**Output:**
```
OK! Created 144 combinations, i.e., `n_sims` = 144.
```
Continue with:
```shell
python -m local_simulator --n_gpus 2 --n_sims 144 --comb_file_id 0
```

Be careful to use the same `--comb_file_id` for both scripts and use the same number of simulations (`--n_sims`) 
as the number of combinations generated by the combinations script.

## Typical Workflow for AdvancedCNN

Ensure you are in your project directory and create the combinations file:

```shell
python -m FdAvg.utils.create_combinations --comb_file_id 0 --fda naive linear sketch --nn AdvancedCNN --b 32 64 128 256 --e 200 --th 0.5
```
**Output:**
```
OK! Created 144 combinations, i.e., `n_sims` = 144.
```
Continue with:
```shell
python -m local_simulator --n_gpus 2 --n_sims 144 --comb_file_id 0 --gpu_mem 5120
```

Be careful to use the same `--comb_file_id` for both scripts and use the same number of simulations (`--n_sims`) 
as the number of combinations generated by the combinations script.

# SLURM simulation

## Typical Workflow for AdvancedCNN

Go to project directory `/FedL-Sync-FDA` and create the combinations file:

```shell
python -m FdAvg.utils.create_combinations --comb_file_id 0 --fda naive linear sketch --nn AdvancedCNN --b 32 64 128 256 --e 200 --th 0.5
```
**Output:**
```
OK! Created 144 combinations, i.e., `n_sims` = 144.
```
Continue with:
```shell
python -m slurm_submitter --gpu_mem 5120 --gpus_per_node 2 --sims_per_gpu 2 --mem_per_sim 10240 --cpus_per_sim 2 --nodes_per_submit 3 --n_sims 144 --comb_file_id 0 --walltime 24:00:00
```

This will create 144 / (2 * 2 * 2) = 18 SLURM submissions, each with 2 nodes, 2 GPUs per node, 2 simulations per GPU - 4 per node, 10 * 2 * 2 = 40 GB memory per node, 2 * 2 * 2 = 8 CPUs per node, and 24 hours walltime.